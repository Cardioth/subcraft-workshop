(function(z){"object"===typeof exports&&"undefined"!==typeof module?module.exports=z():"function"===typeof define&&define.U?define([],z):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).martinez=z()})(function(){return function f(d,h,e){function a(b,q){if(!h[b]){if(!d[b]){var t="function"==typeof require&&require;if(!q&&t)return t(b,!0);if(c)return c(b,!0);t=Error("Cannot find module '"+b+"'");throw t.code="MODULE_NOT_FOUND",t;}t=h[b]={exports:{}};
d[b][0].call(t.exports,function(c){var q=d[b][1][c];return a(q?q:c)},t,t.exports,f,d,h,e)}return h[b].exports}for(var c="function"==typeof require&&require,b=0;b<e.length;b++)a(e[b]);return a}({1:[function(f,d){d.exports=f("./src/index")},{"./src/index":11}],2:[function(f,d){d.exports={P:f("./lib/rbtree"),T:f("./lib/bintree")}},{"./lib/bintree":3,"./lib/rbtree":4}],3:[function(f,d){function h(a){this.data=a;this.right=this.left=null}function e(a){this.c=null;this.m=a;this.size=0}var a=f("./treebase");
h.prototype.g=function(a){return a?this.right:this.left};h.prototype.j=function(a,b){a?this.right=b:this.left=b};e.prototype=new a;e.prototype.M=function(a){if(null===this.c)return this.c=new h(a),this.size++,!0;for(var b=0,g=null,q=this.c;;){if(null===q)return q=new h(a),g.j(b,q),ret=!0,this.size++,!0;if(0===this.m(q.data,a))return!1;b=0>this.m(q.data,a);g=q;q=q.g(b)}};e.prototype.remove=function(a){if(null===this.c)return!1;var b=new h(void 0),g=b;g.right=this.c;for(var q=null,t=null,k=1;null!==
g.g(k);){var q=g,g=g.g(k),e=this.m(a,g.data),k=0<e;0===e&&(t=g)}return null!==t?(t.data=g.data,q.j(q.right===g,g.g(null===g.left)),this.c=b.right,this.size--,!0):!1};d.exports=e},{"./treebase":5}],4:[function(f,d){function h(a){this.data=a;this.right=this.left=null;this.red=!0}function e(a){this.c=null;this.m=a;this.size=0}function a(a){return null!==a&&a.red}function c(a,c){var b=a.g(!c);a.j(!c,b.g(c));b.j(c,a);a.red=!0;b.red=!1;return b}function b(a,b){a.j(!b,c(a.g(!b),!b));return c(a,b)}var g=
f("./treebase");h.prototype.g=function(a){return a?this.right:this.left};h.prototype.j=function(a,b){a?this.right=b:this.left=b};e.prototype=new g;e.prototype.M=function(g){var e=!1;if(null===this.c)this.c=new h(g),e=!0,this.size++;else{var k=new h(void 0),d=0,f=0,u=null,m=k,r=null,l=this.c;for(m.right=this.c;;){null===l?(l=new h(g),r.j(d,l),e=!0,this.size++):a(l.left)&&a(l.right)&&(l.red=!0,l.left.red=!1,l.right.red=!1);if(a(l)&&a(r)){var v=m.right===u;l===r.g(f)?m.j(v,c(u,!f)):m.j(v,b(u,!f))}v=
this.m(l.data,g);if(0===v)break;f=d;d=0>v;null!==u&&(m=u);u=r;r=l;l=l.g(d)}this.c=k.right}this.c.red=!1;return e};e.prototype.remove=function(g){if(null===this.c)return!1;var e=new h(void 0),k=e;k.right=this.c;for(var d=null,f,u=null,m=1;null!==k.g(m);){var r=m;f=d;var d=k,k=k.g(m),l=this.m(g,k.data),m=0<l;0===l&&(u=k);if(!a(k)&&!a(k.g(m)))if(a(k.g(!m)))f=c(k,m),d.j(r,f),d=f;else if(!a(k.g(!m))&&(l=d.g(!r),null!==l))if(a(l.g(!r))||a(l.g(r))){var v=f.right===d;a(l.g(r))?f.j(v,b(d,r)):a(l.g(!r))&&f.j(v,
c(d,r));r=f.g(v);r.red=!0;k.red=!0;r.left.red=!1;r.right.red=!1}else d.red=!1,l.red=!0,k.red=!0}null!==u&&(u.data=k.data,d.j(d.right===k,k.g(null===k.left)),this.size--);this.c=e.right;null!==this.c&&(this.c.red=!1);return null!==u};d.exports=e},{"./treebase":5}],5:[function(f,d){function h(){}function e(a){this.L=a;this.h=[];this.f=null}h.prototype.clear=function(){this.c=null;this.size=0};h.prototype.find=function(a){for(var c=this.c;null!==c;){var b=this.m(a,c.data);if(0===b)return c.data;c=c.g(0<
b)}return null};h.prototype.u=function(a){for(var c=this.c,b=this.iterator();null!==c;){var g=this.m(a,c.data);if(0===g)return b.f=c,b;b.h.push(c);c=c.g(0<g)}return null};h.prototype.lowerBound=function(a){for(var c=this.c,b=this.iterator(),g=this.m;null!==c;){var e=g(a,c.data);if(0===e)return b.f=c,b;b.h.push(c);c=c.g(0<e)}for(e=b.h.length-1;0<=e;--e)if(c=b.h[e],0>g(a,c.data))return b.f=c,b.h.length=e,b;b.h.length=0;return b};h.prototype.upperBound=function(a){for(var c=this.lowerBound(a),b=this.m;null!==
c.data()&&0===b(c.data(),a);)c.next();return c};h.prototype.min=function(){var a=this.c;if(null===a)return null;for(;null!==a.left;)a=a.left;return a.data};h.prototype.max=function(){var a=this.c;if(null===a)return null;for(;null!==a.right;)a=a.right;return a.data};h.prototype.iterator=function(){return new e(this)};e.prototype.data=function(){return null!==this.f?this.f.data:null};e.prototype.next=function(){if(null===this.f){var a=this.L.c;null!==a&&this.K(a)}else if(null===this.f.right){do if(a=
this.f,this.h.length)this.f=this.h.pop();else{this.f=null;break}while(this.f.right===a)}else this.h.push(this.f),this.K(this.f.right);return null!==this.f?this.f.data:null};e.prototype.w=function(){if(null===this.f){var a=this.L.c;null!==a&&this.J(a)}else if(null===this.f.left){do if(a=this.f,this.h.length)this.f=this.h.pop();else{this.f=null;break}while(this.f.left===a)}else this.h.push(this.f),this.J(this.f.left)};e.prototype.K=function(a){for(;null!==a.left;)this.h.push(a),a=a.left;this.f=a};e.prototype.J=
function(a){for(;null!==a.right;)this.h.push(a),a=a.right;this.f=a};d.exports=h},{}],6:[function(f,d){function h(a,c){if(!(this instanceof h))return new h(a,c);this.data=a||[];this.length=this.data.length;this.compare=c||e;if(a)for(var b=Math.floor(this.length/2);0<=b;b--)this.I(b)}function e(a,c){return a<c?-1:a>c?1:0}d.exports=h;h.prototype={push:function(a){this.data.push(a);this.length++;this.R(this.length-1)},pop:function(){var a=this.data[0];this.data[0]=this.data[this.length-1];this.length--;
this.data.pop();this.I(0);return a},R:function(a){for(var c=this.data,b=this.compare;0<a;){var g=Math.floor((a-1)/2);if(0>b(c[a],c[g])){var e=c,d=e[g];e[g]=e[a];e[a]=d;a=g}else break}},I:function(a){for(var c=this.data,b=this.compare,e=this.length;;){var d=2*a+1,h=d+1,k=a;d<e&&0>b(c[d],c[k])&&(k=d);h<e&&0>b(c[h],c[k])&&(k=h);if(k===a)break;d=c;h=d[k];d[k]=d[a];d[a]=h;a=k}}}},{}],7:[function(f,d){var h=f("./signed_area");d.exports=function(e,a){var c=e.a,b=a.a;return c[0]>b[0]?1:c[0]<b[0]?-1:c[1]!==
b[1]?c[1]>b[1]?1:-1:e.left!==a.left?e.left?1:-1:0!==h(c,e.b.a,a.b.a)?e.B(a.b.a)?-1:1:!e.i&&a.i?1:-1}},{"./signed_area":13}],8:[function(f,d){var h=f("./signed_area"),e=f("./compare_events"),a=f("./equals");d.exports=function(c,b){if(c===b)return 0;if(0!==h(c.a,c.b.a,b.a)||0!==h(c.a,c.b.a,b.b.a))return a(c.a,b.a)?c.B(b.b.a)?-1:1:c.a[0]===b.a[0]?c.a[1]<b.a[1]?-1:1:1===e(c,b)?b.S(c.a)?-1:1:c.B(b.a)?-1:1;if(c.i===b.i){if(a(c.a,b.a))return a(c.b.a,b.b.a)?0:c.l>b.l?1:-1}else return c.i?-1:1;return 1===
e(c,b)?1:-1}},{"./compare_events":7,"./equals":10,"./signed_area":13}],9:[function(f,d){d.exports={G:0,O:1,H:2,F:3}},{}],10:[function(f,d){d.exports=function(d,e){return d[0]===e[0]&&d[1]===e[1]}},{}],11:[function(f,d){function h(a,b,c,e,d){var g,k;if("number"===typeof a[0][0])for(g=0,k=a.length-1;g<k;g++){var f=a[g],p=a[g+1],q=b,n=c+1,t=e,m=d,u=new r(f,!1,void 0,q),p=new r(p,!1,u,q);u.b=p;u.l=p.l=n;0<l(u,p)?p.left=!0:u.left=!0;m[0]=A(m[0],f[0]);m[1]=A(m[1],f[1]);m[2]=C(m[2],f[0]);m[3]=C(m[3],f[1]);
t.push(u);t.push(p)}else for(g=0,k=a.length;g<k;g++)B++,h(a[g],b,B,e,d)}function e(a,b,c,e){var d=new u(null,l);B=0;h(a,!0,0,d,c);h(b,!1,0,d,e);return d}function a(a,b,d,e){null===b?(a.s=!1,a.o=!0):a.i===b.i?(a.s=!b.s,a.o=b.o):(a.s=!b.o,a.o=b.N()?!b.s:b.s);b&&(a.A=!c(b,e)||b.N()?b.A:b);a.D=c(a,e)}function c(a,b){switch(a.type){case w.G:switch(b){case 0:return!a.o;case 1:return a.o;case 2:return a.i&&a.o||!a.i&&!a.o;case 3:return!0}case w.H:return 0===b||1===b;case w.F:return 2===b}return!1}function b(a,
b,c){var e=D(a.a,a.b.a,b.a,b.b.a),d=e?e.length:0;if(0===d||1===d&&(x(a.a,b.a)||x(a.b.a,b.b.a)))return 0;if(2===d&&a.i===b.i)return a.l===b.l&&console.warn("Edges of the same polygon overlap",a.a,a.b.a,b.a,b.b.a),0;if(1===d)return x(a.a,e[0])||x(a.b.a,e[0])||g(a,e[0],c),x(b.a,e[0])||x(b.b.a,e[0])||g(b,e[0],c),1;var e=[],h=d=!1;x(a.a,b.a)?d=!0:1===l(a,b)?e.push(b,a):e.push(a,b);x(a.b.a,b.b.a)?h=!0:1===l(a.b,b.b)?e.push(b.b,a.b):e.push(a.b,b.b);if(d&&h||d)return a.type=w.O,b.type=a.s===b.s?w.H:w.F,d&&
!h&&g(e[0].b,e[1].a,c),2;if(h)return g(e[0],e[1].a,c),3;if(e[0]!==e[3].b)return g(e[0],e[1].a,c),g(e[1],e[2].a,c),3;g(e[0],e[1].a,c);g(e[3].b,e[2].a,c);return 3}function g(a,b,c){var e=new r(b,!1,a,a.i);b=new r(b,!0,a.b,a.i);x(a.a,a.b.a)&&console.warn("what is that?",a);e.l=b.l=a.l;0<l(b,a.b)&&(a.b.left=!0,b.left=!1);a.b.b=b;a.b=e;c.push(b);c.push(e);return c}function q(c,e,d,g,h,k){var f,l;d=new m(v);e=[];for(h=A(g[2],h[2]);c.length;){var p=c.pop();e.push(p);if(0===k&&p.a[0]>h||2===k&&p.a[0]>g[2])break;
if(p.left){d.M(p);l=d.u(p);f=d.u(p);p.iterator=d.u(p);if(!f||!l){console.log("brute");var q=d;f=q.iterator();l=q.iterator();for(var q=q.iterator(),n;null!==(n=q.next())&&(f.next(),l.next(),n!==event););l=[f,l];f=l[0];l=l[1]}f.data()!==d.min()?f.w():(f=d.iterator(),f.w(),f.next());l.next();a(p,f.data(),0,k);l.data()&&2===b(p,l.data(),c)&&(a(p,f.data(),0,k),a(p,l.data(),0,k));f.data()&&2===b(f.data(),p,c)&&(l=d.u(f.data()),l.data()!==d.min()?l.w():(l=d.u(d.max()),l.next()),a(f.data(),l.data(),0,k),
a(p,f.data(),0,k))}else p=p.b,l=d.u(p),(f=d.u(p))&&l&&(f.data()!==d.min()?f.w():(f=d.iterator(),f.w(),f.next()),l.next(),d.remove(p),l.data()&&f.data()&&b(f.data(),l.data(),c))}return e}function t(a,b){"[object Array]"===Object.prototype.toString.call(a[0])&&"[object Array]"!==Object.prototype.toString.call(a[0][0])&&(a=[a]);a[b]=[]}function k(a,b,c){var d,f=null;if(0===a.length*b.length)if(0===c)f=y;else if(2===c)f=a;else if(1===c||3===c)f=0===a.length?b:a;if(d=f)return d===y?null:d;var f=[Infinity,
Infinity,-Infinity,-Infinity],g=[Infinity,Infinity,-Infinity,-Infinity],h=e(a,b,f,g);d=null;if(f[0]>g[2]||g[0]>f[2]||f[1]>g[3]||g[1]>f[3])if(0===c)d=y;else if(2===c)d=a;else if(1===c||3===c)d=a.concat(b);if(d)return d===y?null:d;f=q(h,0,0,f,g,c);a=[];b=0;for(c=f.length;b<c;b++)g=f[b],(g.left&&g.D||!g.left&&g.b.D)&&a.push(g);for(f=!1;!f;)for(f=!0,b=0,c=a.length;b<c;b++)b+1<c&&1===l(a[b],a[b+1])&&(f=a,g=b+1,h=f[b],f[b]=f[g],f[g]=h,f=!1);b=0;for(c=a.length;b<c;b++)a[b].v=b;b=0;for(c=a.length;b<c;b++)a[b].left||
(f=a[b].v,a[b].v=a[b].b.v,a[b].b.v=f);f=Array(a.length);g=[];h=[];d=[];var k={};b=0;for(c=a.length;b<c;b++)if(!f[b]){var p=[];g.push(p);var m=g.length-1;h.push(0);d.push(-1);if(a[b].A){var n=a[b].A.l;a[b].A.C?k[n]&&(t(g[d[n]],m),d[m]=d[n],h[m]=h[n],k[m]=!0):(t(g[n],m),d[m]=n,h[m]=h[n]+1,k[m]=!0)}n=b;for(p.push(a[b].a);n>=b;){f[n]=!0;a[n].left?(a[n].C=!1,a[n].l=m):(a[n].b.C=!0,a[n].b.l=m);n=a[n].v;f[n]=!0;p.push(a[n].a);a:{for(var r=a,u=f,v=n+1,w=r.length;v<w&&x(r[v].a,r[n].a);)if(u[v])v+=1;else{n=
v;break a}for(v=n-1;u[v];)--v;n=v}}n=-1===n?b:n;f[n]=f[a[n].v]=!0;a[n].b.C=!0;a[n].b.l=m;h[m]&1&&p.reverse()}return g}var y=[],w=f("./edge_type"),u=f("tinyqueue"),m=f("bintrees").P,r=f("./sweep_event"),l=f("./compare_events"),v=f("./compare_segments"),D=f("./segment_intersection"),x=f("./equals"),C=Math.max,A=Math.min,B=0;d.exports=k;d.exports.union=function(a,b){return k(a,b,1)};d.exports.diff=function(a,b){return k(a,b,2)};d.exports.$=function(a,b){return k(a,b,3)};d.exports.intersection=function(a,
b){return k(a,b,0)};d.exports.operations={INTERSECTION:0,DIFFERENCE:2,UNION:1,XOR:3};d.exports.X=e;d.exports.V=a;d.exports.Z=q;d.exports.W=g;d.exports.Y=b},{"./compare_events":7,"./compare_segments":8,"./edge_type":9,"./equals":10,"./segment_intersection":12,"./sweep_event":14,bintrees:2,tinyqueue:6}],12:[function(f,d){function h(a,c){return a[0]*c[1]-a[1]*c[0]}function e(a,c){return a[0]*c[0]+a[1]*c[1]}d.exports=function(a,c,b,d,f){function t(a,b,c){return[a[0]+b*c[0],a[1]+b*c[1]]}c=[c[0]-a[0],c[1]-
a[1]];d=[d[0]-b[0],d[1]-b[1]];b=[b[0]-a[0],b[1]-a[1]];var k=h(c,d),y=e(c,c);if(k*k>1E-9*y*e(d,d)){d=h(b,d)/k;if(0>d||1<d)return null;b=h(b,c)/k;return 0>b||1<b?null:f?null:[t(a,d,c)]}var w=e(b,b),k=h(b,c);if(k*k>1E-9*y*w)return null;b=e(c,b)/y;k=b+e(c,d)/y;d=Math.min(b,k);b=Math.max(b,k);return 1>=d&&0<=b?1===d?f?null:[t(a,0<d?d:0,c)]:0===b?f?null:[t(a,1>b?b:1,c)]:f&&0===d&&1===b?null:[t(a,0<d?d:0,c),t(a,1>b?b:1,c)]:null}},{}],13:[function(f,d){d.exports=function(d,e,a){return(d[0]-a[0])*(e[1]-a[1])-
(e[0]-a[0])*(d[1]-a[1])}},{}],14:[function(f,d){function h(c,b,d,e,f){this.left=b;this.a=c;this.b=d;this.i=e;this.type=f||a.G;this.o=this.s=!1;this.A=null;this.C=this.D=!1}var e=f("./signed_area"),a=f("./edge_type");h.prototype={B:function(a){return this.left?0<e(this.a,this.b.a,a):0<e(this.b.a,this.a,a)},S:function(a){return!this.B(a)},N:function(){return this.a[0]===this.b.a[0]}};d.exports=h},{"./edge_type":9,"./signed_area":13}]},{},[1])(1)});
